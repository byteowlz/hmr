{"id":"hmr-0et","title":"Token logged in debug mode exposes credentials","description":"In websocket.rs:133, the authentication token is included in the JSON message sent via WebSocket. While the message itself isn't logged, the log::debug! calls in api.rs (lines 47, 63, 82) log full request bodies. If debug logging is enabled, this could expose the token in logs. Should redact or avoid logging sensitive data.","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-06T12:45:53.319725976+01:00","updated_at":"2025-12-06T12:46:04.571229117+01:00"}
{"id":"hmr-0j8","title":"Client certificate path option not implemented in HassClient","description":"The --cert CLI option (cli.rs:49-50) and cert_path config (config.rs:174) are defined but never used in HassClient (api.rs). Users expecting mTLS client certificate authentication will find the feature silently ignored. Either implement or remove the option.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:45:57.849852224+01:00","updated_at":"2025-12-06T12:46:14.096296782+01:00"}
{"id":"hmr-0zu","title":"Consider using impl Into\u003cString\u003e instead of \u0026str for owned values","description":"Several functions take \u0026str then immediately call .to_string() (e.g., api.rs:24-25). For parameters that will always be owned, consider accepting impl Into\u003cString\u003e to avoid unnecessary allocations when caller already has String.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T12:47:07.802743399+01:00","updated_at":"2025-12-06T12:47:07.802743399+01:00"}
{"id":"hmr-16j","title":"Unbounded memory growth when watching events without backpressure","description":"In websocket.rs:91-92, mpsc channels are created with fixed buffer size (32), but the receiver loop (106-115) has no backpressure mechanism. If events arrive faster than they can be processed, the sender task will block. Consider implementing proper backpressure or dropping old events.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:46:26.195269672+01:00","updated_at":"2025-12-06T12:46:26.195269672+01:00"}
{"id":"hmr-2w3","title":"WebSocket uses String allocation instead of Cow for efficiency","description":"In websocket.rs:154-159, send_raw takes \u0026str but immediately allocates a String. The WsClient::send method at line 168 clones the entire Value. Consider using Cow\u003cstr\u003e or avoiding unnecessary allocations in the hot path.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:30.814108533+01:00","updated_at":"2025-12-06T12:46:30.814108533+01:00"}
{"id":"hmr-3zj","title":"HassClient recreated on every command instead of being reused","description":"In entity.rs, service.rs, event.rs, etc., HassClient::new(ctx) is called for each subcommand invocation. While not an issue for single commands, this prevents connection pooling benefits. Consider reusing the underlying reqwest Client or implementing connection keep-alive for batch operations.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:23.709507899+01:00","updated_at":"2025-12-06T12:46:23.709507899+01:00"}
{"id":"hmr-7bt","title":"Use ? operator instead of unwrap_or_default in error paths","description":"api.rs:100 uses response.text().await.unwrap_or_default() which silently ignores errors reading the error body. Consider logging or propagating these errors, or at least documenting why failures are acceptable here.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T12:47:05.451658194+01:00","updated_at":"2025-12-06T12:47:05.451658194+01:00"}
{"id":"hmr-8qs","title":"Duplicate subscription confirmation loop in websocket.rs","description":"watch_events() lines 223-238 and watch_entities() lines 274-289 contain identical subscription confirmation loops. This pattern should be extracted to a helper method like wait_for_subscription_confirmation(client, sub_id).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:45.27328238+01:00","updated_at":"2025-12-06T12:46:45.27328238+01:00"}
{"id":"hmr-c0h","title":"Config file permissions not checked - token readable by other users","description":"In config.rs:297-319, write_default_config creates the config file with default umask permissions. Since the config can contain the HASS token, this may leave sensitive credentials world-readable. Should set restrictive permissions (0600) when writing config files containing tokens.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-06T12:45:56.495396837+01:00","updated_at":"2025-12-06T12:46:11.505534091+01:00"}
{"id":"hmr-ctc","title":"Use Option::filter instead of filter(|v| !v.is_empty()) pattern","description":"config.rs:333 uses env::var_os('XDG_CONFIG_HOME').filter(|v| !v.is_empty()). This is fine but could be slightly more idiomatic with a helper. Low priority style improvement.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-06T12:47:14.877947518+01:00","updated_at":"2025-12-06T12:47:14.877947518+01:00"}
{"id":"hmr-dq9","title":"Implement Home Assistant CLI (hmr)","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-06T10:55:42.200554905+01:00","updated_at":"2025-12-06T11:09:21.898730997+01:00","closed_at":"2025-12-06T11:09:21.898730997+01:00"}
{"id":"hmr-dq9.1","title":"Phase 1: Core infrastructure and basic commands","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:55:47.128497957+01:00","updated_at":"2025-12-06T11:09:15.066254113+01:00","closed_at":"2025-12-06T11:09:15.066254113+01:00","dependencies":[{"issue_id":"hmr-dq9.1","depends_on_id":"hmr-dq9","type":"parent-child","created_at":"2025-12-06T10:55:47.129098226+01:00","created_by":"daemon"}]}
{"id":"hmr-dq9.2","title":"Phase 2: WebSocket support and streaming","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:55:48.309302514+01:00","updated_at":"2025-12-06T11:09:16.482895581+01:00","closed_at":"2025-12-06T11:09:16.482895581+01:00","dependencies":[{"issue_id":"hmr-dq9.2","depends_on_id":"hmr-dq9","type":"parent-child","created_at":"2025-12-06T10:55:48.309752673+01:00","created_by":"daemon"}]}
{"id":"hmr-dq9.3","title":"Phase 3: Area/device management and polish","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:55:49.620546804+01:00","updated_at":"2025-12-06T11:09:17.753587094+01:00","closed_at":"2025-12-06T11:09:17.753587094+01:00","dependencies":[{"issue_id":"hmr-dq9.3","depends_on_id":"hmr-dq9","type":"parent-child","created_at":"2025-12-06T10:55:49.621071042+01:00","created_by":"daemon"}]}
{"id":"hmr-gbh","title":"WebSocket silently drops malformed messages without logging","description":"In websocket.rs:106-113, when a WebSocket message fails to deserialize (serde_json::from_str fails), it is silently dropped without any logging. This makes debugging connection issues difficult and could hide security-relevant messages. Should log failed parse attempts at debug level.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-06T12:45:54.260173616+01:00","updated_at":"2025-12-06T12:46:06.612352302+01:00"}
{"id":"hmr-gkn","title":"Entity list loads all states into memory before filtering","description":"In entity.rs:67, get_states() loads all entities into a Vec before filtering. For large HA installations with thousands of entities, this is inefficient. Consider streaming/pagination support or server-side filtering if the HA API supports it.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:28.392573644+01:00","updated_at":"2025-12-06T12:46:28.392573644+01:00"}
{"id":"hmr-i66","title":"spawned tasks in WsClient have no error handling or join handles","description":"In websocket.rs:96-115, tokio::spawn creates detached tasks. If these tasks panic, errors are silently lost. The JoinHandles are discarded. Should store handles and/or implement proper error propagation (e.g., via the channel or a dedicated error path).","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:47:12.8249978+01:00","updated_at":"2025-12-06T12:47:12.8249978+01:00"}
{"id":"hmr-k3t","title":"thiserror dependency unused - only anyhow is used for errors","description":"Cargo.toml includes thiserror='2.0' but no custom error types using #[derive(Error)] exist in the codebase. All error handling uses anyhow. Either remove thiserror or define typed errors for better error handling (e.g., HassApiError enum).","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-06T12:47:01.240119622+01:00","updated_at":"2025-12-06T12:47:01.240119622+01:00"}
{"id":"hmr-ltv","title":"url crate unused despite being in dependencies","description":"Cargo.toml includes url='2.5' but it's not used anywhere. URL manipulation is done via string operations. Either remove the dependency or use it properly for URL parsing/building in api.rs and websocket.rs.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-06T12:47:03.292538011+01:00","updated_at":"2025-12-06T12:47:03.292538011+01:00"}
{"id":"hmr-mk3","title":"Consider using typed builders for API requests","description":"api.rs uses serde_json::Value for request bodies. Consider typed request structs (e.g., SetStateRequest, CallServiceRequest) for better compile-time validation and documentation.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T12:47:16.652454728+01:00","updated_at":"2025-12-06T12:47:16.652454728+01:00"}
{"id":"hmr-o03","title":"No input validation on entity_id allows injection in URL paths","description":"In api.rs, entity_id values are directly interpolated into URL paths (lines 169, 174, 183-185) without validation or URL encoding. Malicious entity_id values like '../../../etc/passwd' or 'foo?admin=true' could manipulate requests. Should validate entity_id format (domain.object_id pattern) and/or URL-encode values.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-06T12:45:55.446545538+01:00","updated_at":"2025-12-06T12:46:09.185530249+01:00"}
{"id":"hmr-obg","title":"print_table doesn't respect JSON/YAML output format","description":"In output.rs:48-70, print_table() ignores JSON/YAML format requests and always prints a table. Lines 53-58 and 61-64 are effectively dead code. Either implement proper JSON/YAML output for Tabled items or document the limitation.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:46:50.273871654+01:00","updated_at":"2025-12-06T12:46:50.273871654+01:00"}
{"id":"hmr-pd9","title":"Duplicate truncate function in service.rs - should be shared utility","description":"service.rs:131-137 has a truncate() function. This is a common utility that could be used elsewhere (e.g., entity display). Should move to output.rs or a shared utils module.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:43.042997722+01:00","updated_at":"2025-12-06T12:46:43.042997722+01:00"}
{"id":"hmr-qc4","title":"WebSocket URL conversion should be a shared utility function","description":"In websocket.rs:76-79, HTTP to WS URL conversion uses simple string replace. This should be a tested utility function that properly handles edge cases (ports, paths, query strings). Could live in api.rs or a shared module.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:52.367371346+01:00","updated_at":"2025-12-06T12:46:52.367371346+01:00"}
{"id":"hmr-rab","title":"Duplicate output format match blocks across command files","description":"entity.rs, service.rs, event.rs, info.rs all have similar match ctx.output_format() blocks with Json/Yaml/Table/Auto arms. Consider a macro or helper that handles the common pattern, or use a trait-based approach for command output.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:47.907674488+01:00","updated_at":"2025-12-06T12:46:47.907674488+01:00"}
{"id":"hmr-wzt","title":"Use #[non_exhaustive] on public enums for forward compatibility","description":"WsMessage enum in websocket.rs and OutputFormat in cli.rs are public and could have variants added. Adding #[non_exhaustive] would allow adding variants without breaking downstream code.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T12:47:09.76528838+01:00","updated_at":"2025-12-06T12:47:09.76528838+01:00"}
{"id":"hmr-yig","title":"tokio runtime uses current_thread but features=full includes multi-thread","description":"Cargo.toml includes tokio with features=['full'], but main.rs:39 uses new_current_thread(). The 'full' feature includes rt-multi-thread which is unused. Should specify only needed features: rt, macros, time, signal, io-util, net for smaller binary.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:33.74240352+01:00","updated_at":"2025-12-06T12:46:33.74240352+01:00"}
