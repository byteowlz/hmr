{"id":"hmr-0et","title":"Token logged in debug mode exposes credentials","description":"In websocket.rs:133, the authentication token is included in the JSON message sent via WebSocket. While the message itself isn't logged, the log::debug! calls in api.rs (lines 47, 63, 82) log full request bodies. If debug logging is enabled, this could expose the token in logs. Should redact or avoid logging sensitive data.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-06T12:45:53.319725976+01:00","updated_at":"2025-12-06T13:23:34.909564341+01:00","closed_at":"2025-12-06T13:23:34.909564341+01:00"}
{"id":"hmr-0j8","title":"Client certificate path option not implemented in HassClient","description":"The --cert CLI option (cli.rs:49-50) and cert_path config (config.rs:174) are defined but never used in HassClient (api.rs). Users expecting mTLS client certificate authentication will find the feature silently ignored. Either implement or remove the option.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:45:57.849852224+01:00","updated_at":"2025-12-06T13:23:38.08188803+01:00","closed_at":"2025-12-06T13:23:38.08188803+01:00"}
{"id":"hmr-0zu","title":"Consider using impl Into\u003cString\u003e instead of \u0026str for owned values","description":"Several functions take \u0026str then immediately call .to_string() (e.g., api.rs:24-25). For parameters that will always be owned, consider accepting impl Into\u003cString\u003e to avoid unnecessary allocations when caller already has String.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T12:47:07.802743399+01:00","updated_at":"2025-12-06T14:31:53.721558982+01:00","closed_at":"2025-12-06T14:31:53.721558982+01:00"}
{"id":"hmr-16j","title":"Unbounded memory growth when watching events without backpressure","description":"In websocket.rs:91-92, mpsc channels are created with fixed buffer size (32), but the receiver loop (106-115) has no backpressure mechanism. If events arrive faster than they can be processed, the sender task will block. Consider implementing proper backpressure or dropping old events.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:46:26.195269672+01:00","updated_at":"2025-12-06T13:23:42.553207387+01:00","closed_at":"2025-12-06T13:23:42.553207387+01:00"}
{"id":"hmr-2w3","title":"WebSocket uses String allocation instead of Cow for efficiency","description":"In websocket.rs:154-159, send_raw takes \u0026str but immediately allocates a String. The WsClient::send method at line 168 clones the entire Value. Consider using Cow\u003cstr\u003e or avoiding unnecessary allocations in the hot path.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:30.814108533+01:00","updated_at":"2025-12-06T14:32:01.314529543+01:00","closed_at":"2025-12-06T14:32:01.314529543+01:00"}
{"id":"hmr-3zj","title":"HassClient recreated on every command instead of being reused","description":"In entity.rs, service.rs, event.rs, etc., HassClient::new(ctx) is called for each subcommand invocation. While not an issue for single commands, this prevents connection pooling benefits. Consider reusing the underlying reqwest Client or implementing connection keep-alive for batch operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:23.709507899+01:00","updated_at":"2025-12-06T13:23:41.815150551+01:00","closed_at":"2025-12-06T13:23:41.815150551+01:00"}
{"id":"hmr-47n","title":"Implement area list command via WebSocket API","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-06T16:04:30.41315+01:00","updated_at":"2025-12-06T16:09:04.319932+01:00","closed_at":"2025-12-06T16:09:04.319932+01:00"}
{"id":"hmr-5l6","title":"Implement service-based NL commands (e.g., 'call light turn_on')","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T12:02:06.109359+01:00","updated_at":"2025-12-07T12:02:06.109359+01:00"}
{"id":"hmr-5rf","title":"Extend WebSocket client to support RPC calls for area/device registry","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T16:04:29.541303+01:00","updated_at":"2025-12-06T16:09:03.372729+01:00","closed_at":"2025-12-06T16:09:03.372729+01:00"}
{"id":"hmr-6tc","title":"Human \u0026 AI-Friendly CLI","description":"Make hmr CLI more forgiving and natural for both humans and AI agents. Includes: typo tolerance, natural language commands, flexible argument order, multi-device targeting, caching, and command history/context memory.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-06T22:26:36.511638892+01:00","updated_at":"2025-12-06T22:39:42.115366636+01:00","closed_at":"2025-12-06T22:39:42.115366636+01:00"}
{"id":"hmr-6tc.1","title":"Entity caching system","description":"Cache entities, areas, services, devices, and labels to XDG_CACHE_HOME with TTL. Support cache status/refresh/clear commands. Foundation for fuzzy matching.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:26:46.773507865+01:00","updated_at":"2025-12-06T22:30:57.194027984+01:00","closed_at":"2025-12-06T22:30:57.194027984+01:00","dependencies":[{"issue_id":"hmr-6tc.1","depends_on_id":"hmr-6tc","type":"parent-child","created_at":"2025-12-06T22:26:46.774296973+01:00","created_by":"daemon"}]}
{"id":"hmr-6tc.2","title":"Fuzzy matching layer","description":"Add Levenshtein distance matching for commands, entity IDs, services, and domains. Auto-correct typos within threshold. Show corrections with arrow notation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:26:48.457028648+01:00","updated_at":"2025-12-06T22:32:57.527045742+01:00","closed_at":"2025-12-06T22:32:57.527045742+01:00","dependencies":[{"issue_id":"hmr-6tc.2","depends_on_id":"hmr-6tc","type":"parent-child","created_at":"2025-12-06T22:26:48.457643958+01:00","created_by":"daemon"},{"issue_id":"hmr-6tc.2","depends_on_id":"hmr-6tc.1","type":"blocks","created_at":"2025-12-06T22:27:12.302115154+01:00","created_by":"daemon"}]}
{"id":"hmr-6tc.3","title":"Natural language command parser","description":"Parse natural language commands like 'turn on kitchen light'. Extract action verbs, targets, and parameters. Support flexible argument order.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:26:49.944714061+01:00","updated_at":"2025-12-06T22:35:40.306547841+01:00","closed_at":"2025-12-06T22:35:40.306547841+01:00","dependencies":[{"issue_id":"hmr-6tc.3","depends_on_id":"hmr-6tc","type":"parent-child","created_at":"2025-12-06T22:26:49.945345729+01:00","created_by":"daemon"},{"issue_id":"hmr-6tc.3","depends_on_id":"hmr-6tc.2","type":"blocks","created_at":"2025-12-06T22:27:12.314155006+01:00","created_by":"daemon"}]}
{"id":"hmr-6tc.4","title":"Multi-device targeting","description":"Support targeting multiple entities in single API call. Syntax: lists, areas, patterns, labels, plurals (lights off). Use HA target arrays for efficiency.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:26:51.60368871+01:00","updated_at":"2025-12-06T22:36:20.787919835+01:00","closed_at":"2025-12-06T22:36:20.787919835+01:00","dependencies":[{"issue_id":"hmr-6tc.4","depends_on_id":"hmr-6tc","type":"parent-child","created_at":"2025-12-06T22:26:51.604258808+01:00","created_by":"daemon"},{"issue_id":"hmr-6tc.4","depends_on_id":"hmr-6tc.3","type":"blocks","created_at":"2025-12-06T22:27:12.324840232+01:00","created_by":"daemon"}]}
{"id":"hmr-6tc.5","title":"Command history and context memory","description":"Store command history in JSONL. Track current context for follow-up commands (hmr brighter). Support 'again', 'undo', 'history' commands. Add accuracy stats tracking.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:26:53.942675099+01:00","updated_at":"2025-12-06T22:39:37.385343541+01:00","closed_at":"2025-12-06T22:39:37.385343541+01:00","dependencies":[{"issue_id":"hmr-6tc.5","depends_on_id":"hmr-6tc","type":"parent-child","created_at":"2025-12-06T22:26:53.943523858+01:00","created_by":"daemon"},{"issue_id":"hmr-6tc.5","depends_on_id":"hmr-6tc.4","type":"blocks","created_at":"2025-12-06T22:27:12.3344326+01:00","created_by":"daemon"}]}
{"id":"hmr-71w","title":"Use matched_on field for better error messages","description":"","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-07T12:02:08.484342+01:00","updated_at":"2025-12-07T12:02:08.484342+01:00"}
{"id":"hmr-7bt","title":"Use ? operator instead of unwrap_or_default in error paths","description":"api.rs:100 uses response.text().await.unwrap_or_default() which silently ignores errors reading the error body. Consider logging or propagating these errors, or at least documenting why failures are acceptable here.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T12:47:05.451658194+01:00","updated_at":"2025-12-06T14:31:57.682371604+01:00","closed_at":"2025-12-06T14:31:57.682371604+01:00"}
{"id":"hmr-8qs","title":"Duplicate subscription confirmation loop in websocket.rs","description":"watch_events() lines 223-238 and watch_entities() lines 274-289 contain identical subscription confirmation loops. This pattern should be extracted to a helper method like wait_for_subscription_confirmation(client, sub_id).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:45.27328238+01:00","updated_at":"2025-12-06T13:23:44.035921603+01:00","closed_at":"2025-12-06T13:23:44.035921603+01:00"}
{"id":"hmr-af5","title":"Fix broken pipe panic when output is piped to commands like cd","description":"When running 'hmr config path | cd', the program panics with 'failed printing to stdout: Broken pipe'. Need to handle SIGPIPE/EPIPE gracefully.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T16:05:40.183491+01:00","updated_at":"2025-12-06T16:09:02.110071+01:00","closed_at":"2025-12-06T16:09:02.110071+01:00"}
{"id":"hmr-c0h","title":"Config file permissions not checked - token readable by other users","description":"In config.rs:297-319, write_default_config creates the config file with default umask permissions. Since the config can contain the HASS token, this may leave sensitive credentials world-readable. Should set restrictive permissions (0600) when writing config files containing tokens.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T12:45:56.495396837+01:00","updated_at":"2025-12-06T13:23:37.351126905+01:00","closed_at":"2025-12-06T13:23:37.351126905+01:00"}
{"id":"hmr-ch2","title":"Use domain_overrides for domain-specific service routing","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T12:02:11.324737+01:00","updated_at":"2025-12-07T12:02:11.324737+01:00"}
{"id":"hmr-ctc","title":"Use Option::filter instead of filter(|v| !v.is_empty()) pattern","description":"config.rs:333 uses env::var_os('XDG_CONFIG_HOME').filter(|v| !v.is_empty()). This is fine but could be slightly more idiomatic with a helper. Low priority style improvement.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-06T12:47:14.877947518+01:00","updated_at":"2025-12-06T14:32:03.844836202+01:00","closed_at":"2025-12-06T14:32:03.844836202+01:00"}
{"id":"hmr-cwl","title":"Use MatchResult::is_exact() for conditional logic","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T12:02:10.685925+01:00","updated_at":"2025-12-07T12:02:10.685925+01:00"}
{"id":"hmr-dq9","title":"Implement Home Assistant CLI (hmr)","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-06T10:55:42.200554905+01:00","updated_at":"2025-12-06T11:09:21.898730997+01:00","closed_at":"2025-12-06T11:09:21.898730997+01:00"}
{"id":"hmr-dq9.1","title":"Phase 1: Core infrastructure and basic commands","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:55:47.128497957+01:00","updated_at":"2025-12-06T11:09:15.066254113+01:00","closed_at":"2025-12-06T11:09:15.066254113+01:00","dependencies":[{"issue_id":"hmr-dq9.1","depends_on_id":"hmr-dq9","type":"parent-child","created_at":"2025-12-06T10:55:47.129098226+01:00","created_by":"daemon"}]}
{"id":"hmr-dq9.2","title":"Phase 2: WebSocket support and streaming","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:55:48.309302514+01:00","updated_at":"2025-12-06T11:09:16.482895581+01:00","closed_at":"2025-12-06T11:09:16.482895581+01:00","dependencies":[{"issue_id":"hmr-dq9.2","depends_on_id":"hmr-dq9","type":"parent-child","created_at":"2025-12-06T10:55:48.309752673+01:00","created_by":"daemon"}]}
{"id":"hmr-dq9.3","title":"Phase 3: Area/device management and polish","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:55:49.620546804+01:00","updated_at":"2025-12-06T11:09:17.753587094+01:00","closed_at":"2025-12-06T11:09:17.753587094+01:00","dependencies":[{"issue_id":"hmr-dq9.3","depends_on_id":"hmr-dq9","type":"parent-child","created_at":"2025-12-06T10:55:49.621071042+01:00","created_by":"daemon"}]}
{"id":"hmr-fag","title":"Implement cache_mut() usage for dynamic cache updates","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T12:02:12.168526+01:00","updated_at":"2025-12-07T12:02:12.168526+01:00"}
{"id":"hmr-gbh","title":"WebSocket silently drops malformed messages without logging","description":"In websocket.rs:106-113, when a WebSocket message fails to deserialize (serde_json::from_str fails), it is silently dropped without any logging. This makes debugging connection issues difficult and could hide security-relevant messages. Should log failed parse attempts at debug level.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T12:45:54.260173616+01:00","updated_at":"2025-12-06T13:23:35.72821368+01:00","closed_at":"2025-12-06T13:23:35.72821368+01:00"}
{"id":"hmr-gkn","title":"Entity list loads all states into memory before filtering","description":"In entity.rs:67, get_states() loads all entities into a Vec before filtering. For large HA installations with thousands of entities, this is inefficient. Consider streaming/pagination support or server-side filtering if the HA API supports it.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:28.392573644+01:00","updated_at":"2025-12-06T14:32:02.788457153+01:00","closed_at":"2025-12-06T14:32:02.788457153+01:00"}
{"id":"hmr-h9k","title":"Use ensure_* methods in cache command to auto-refresh","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T12:02:05.033024+01:00","updated_at":"2025-12-07T12:02:05.033024+01:00"}
{"id":"hmr-i66","title":"spawned tasks in WsClient have no error handling or join handles","description":"In websocket.rs:96-115, tokio::spawn creates detached tasks. If these tasks panic, errors are silently lost. The JoinHandles are discarded. Should store handles and/or implement proper error propagation (e.g., via the channel or a dedicated error path).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:47:12.8249978+01:00","updated_at":"2025-12-06T14:31:47.192237978+01:00","closed_at":"2025-12-06T14:31:47.192237978+01:00"}
{"id":"hmr-jtk","title":"Use MatchType::priority() for sorting multiple matches","description":"","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-07T12:02:09.977636+01:00","updated_at":"2025-12-07T12:02:09.977636+01:00"}
{"id":"hmr-k3t","title":"thiserror dependency unused - only anyhow is used for errors","description":"Cargo.toml includes thiserror='2.0' but no custom error types using #[derive(Error)] exist in the codebase. All error handling uses anyhow. Either remove thiserror or define typed errors for better error handling (e.g., HassApiError enum).","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-06T12:47:01.240119622+01:00","updated_at":"2025-12-06T13:23:45.920523197+01:00","closed_at":"2025-12-06T13:23:45.920523197+01:00"}
{"id":"hmr-kkb","title":"Implement cache lookup commands (entity info, area info)","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T12:02:04.014322+01:00","updated_at":"2025-12-07T12:02:04.014322+01:00"}
{"id":"hmr-ltv","title":"url crate unused despite being in dependencies","description":"Cargo.toml includes url='2.5' but it's not used anywhere. URL manipulation is done via string operations. Either remove the dependency or use it properly for URL parsing/building in api.rs and websocket.rs.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-06T12:47:03.292538011+01:00","updated_at":"2025-12-06T13:23:44.871388519+01:00","closed_at":"2025-12-06T13:23:44.871388519+01:00"}
{"id":"hmr-m2v","title":"Implement Match::map() for transforming match types","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T12:02:09.191239+01:00","updated_at":"2025-12-07T12:02:09.191239+01:00"}
{"id":"hmr-mk3","title":"Consider using typed builders for API requests","description":"api.rs uses serde_json::Value for request bodies. Consider typed request structs (e.g., SetStateRequest, CallServiceRequest) for better compile-time validation and documentation.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-06T12:47:16.652454728+01:00","updated_at":"2025-12-06T14:31:51.446922256+01:00","closed_at":"2025-12-06T14:31:51.446922256+01:00"}
{"id":"hmr-n1h","title":"Fix all remaining compiler warnings","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T09:56:35.918831+01:00","updated_at":"2025-12-07T11:48:27.339866+01:00","closed_at":"2025-12-07T11:48:27.339866+01:00"}
{"id":"hmr-o03","title":"No input validation on entity_id allows injection in URL paths","description":"In api.rs, entity_id values are directly interpolated into URL paths (lines 169, 174, 183-185) without validation or URL encoding. Malicious entity_id values like '../../../etc/passwd' or 'foo?admin=true' could manipulate requests. Should validate entity_id format (domain.object_id pattern) and/or URL-encode values.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-06T12:45:55.446545538+01:00","updated_at":"2025-12-06T13:23:36.508882287+01:00","closed_at":"2025-12-06T13:23:36.508882287+01:00"}
{"id":"hmr-obg","title":"print_table doesn't respect JSON/YAML output format","description":"In output.rs:48-70, print_table() ignores JSON/YAML format requests and always prints a table. Lines 53-58 and 61-64 are effectively dead code. Either implement proper JSON/YAML output for Tabled items or document the limitation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-06T12:46:50.273871654+01:00","updated_at":"2025-12-06T14:31:48.722551092+01:00","closed_at":"2025-12-06T14:31:48.722551092+01:00"}
{"id":"hmr-p75","title":"Implement history command using history_path()","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T12:02:07.700584+01:00","updated_at":"2025-12-07T12:02:07.700584+01:00"}
{"id":"hmr-pd9","title":"Duplicate truncate function in service.rs - should be shared utility","description":"service.rs:131-137 has a truncate() function. This is a common utility that could be used elsewhere (e.g., entity display). Should move to output.rs or a shared utils module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:43.042997722+01:00","updated_at":"2025-12-06T13:23:43.235952294+01:00","closed_at":"2025-12-06T13:23:43.235952294+01:00"}
{"id":"hmr-pmd","title":"implement all websocket functionality like listing devices etc. leave no stubs","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T16:41:37.369908+01:00","updated_at":"2025-12-06T16:44:15.908357+01:00","closed_at":"2025-12-06T16:44:15.908357+01:00"}
{"id":"hmr-q3h","title":"Show typo corrections in command output using format_correction()","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T12:02:06.943706+01:00","updated_at":"2025-12-07T12:02:06.943706+01:00"}
{"id":"hmr-qc4","title":"WebSocket URL conversion should be a shared utility function","description":"In websocket.rs:76-79, HTTP to WS URL conversion uses simple string replace. This should be a tested utility function that properly handles edge cases (ports, paths, query strings). Could live in api.rs or a shared module.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:52.367371346+01:00","updated_at":"2025-12-06T14:31:58.68172608+01:00","closed_at":"2025-12-06T14:31:58.68172608+01:00"}
{"id":"hmr-rab","title":"Duplicate output format match blocks across command files","description":"entity.rs, service.rs, event.rs, info.rs all have similar match ctx.output_format() blocks with Json/Yaml/Table/Auto arms. Consider a macro or helper that handles the common pattern, or use a trait-based approach for command output.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T12:46:47.907674488+01:00","updated_at":"2025-12-06T14:31:50.358013192+01:00","closed_at":"2025-12-06T14:31:50.358013192+01:00"}
{"id":"hmr-wx4","title":"Implement area delete command via WebSocket API","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-06T16:04:31.48686+01:00","updated_at":"2025-12-06T16:09:06.120641+01:00","closed_at":"2025-12-06T16:09:06.120641+01:00"}
{"id":"hmr-wzt","title":"Use #[non_exhaustive] on public enums for forward compatibility","description":"WsMessage enum in websocket.rs and OutputFormat in cli.rs are public and could have variants added. Adding #[non_exhaustive] would allow adding variants without breaking downstream code.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T12:47:09.76528838+01:00","updated_at":"2025-12-06T14:31:52.465328224+01:00","closed_at":"2025-12-06T14:31:52.465328224+01:00"}
{"id":"hmr-x4k","title":"Implement area create command via WebSocket API","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-06T16:04:30.950748+01:00","updated_at":"2025-12-06T16:09:05.17534+01:00","closed_at":"2025-12-06T16:09:05.17534+01:00"}
{"id":"hmr-yig","title":"tokio runtime uses current_thread but features=full includes multi-thread","description":"Cargo.toml includes tokio with features=['full'], but main.rs:39 uses new_current_thread(). The 'full' feature includes rt-multi-thread which is unused. Should specify only needed features: rt, macros, time, signal, io-util, net for smaller binary.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T12:46:33.74240352+01:00","updated_at":"2025-12-06T14:32:00.169522245+01:00","closed_at":"2025-12-06T14:32:00.169522245+01:00"}
